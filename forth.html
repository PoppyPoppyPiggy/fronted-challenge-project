<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>달력</title>

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Poppins", sans-serif;
      }

      .wrapper {
        max-width: 400px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f9f9f9;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      .nav {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 20px;
      }

      .current-date {
        font-size: 22px;
        font-weight: 600;
        color: #333;
      }

      .icon {
        font-size: 24px;
        cursor: pointer;
        background-color: transparent;
        border: none;
      }

      .icon:hover {
        color: #008aff;
      }

      .calendar {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 10px;
      }

      .day {
        text-align: center;
        cursor: pointer;
        padding: 10px;
        font-size: 16px;
        border-radius: 5px;
      }

      .day:hover {
        background-color: #f0f0f0;
      }

      .day.with-note {
        position: relative;
      }

      .day.with-note::after {
        content: "";
        position: absolute;
        bottom: 5px;
        right: 5px;
        width: 6px;
        height: 6px;
        background-color: #ff4500;
        border-radius: 50%;
      }

      .modal {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: #fff;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        z-index: 100;
      }

      .modal textarea {
        width: 100%;
        height: 100px;
        margin-bottom: 10px;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        resize: none;
      }

      .modal button {
        padding: 10px 20px;
        background-color: #008aff;
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }

      .modal button:hover {
        background-color: #0056b3;
      }
    </style>
  </head>
  <body>
    <div class="wrapper">
      <div class="nav">
        <button id="prevMonth" class="icon">&lt;</button>
        <p id="monthYearDisplay" class="current-date"></p>
        <button id="nextMonth" class="icon">&gt;</button>
      </div>
      <div class="calendar" id="calendar"></div>
    </div>

    <div id="noteModal" class="modal">
      <textarea id="noteInput" placeholder="메모를 입력하세요..."></textarea>
      <button id="saveNote">메모 저장</button>
    </div>

    <script>
      const monthYearDisplay = document.getElementById("monthYearDisplay");
      const prevMonthButton = document.getElementById("prevMonth");
      const nextMonthButton = document.getElementById("nextMonth");
      const calendar = document.getElementById("calendar");
      const noteModal = document.getElementById("noteModal");
      const noteInput = document.getElementById("noteInput");
      const saveNoteButton = document.getElementById("saveNote");

      let currentDate = new Date();
      let currentMonth = currentDate.getMonth();
      let currentYear = currentDate.getFullYear();

      renderCalendar(currentMonth, currentYear);
      loadSavedNotes();

      prevMonthButton.addEventListener("click", () => {
        if (currentMonth === 0) {
          currentMonth = 11;
          currentYear--;
        } else {
          currentMonth--;
        }
        renderCalendar(currentMonth, currentYear);
      });

      nextMonthButton.addEventListener("click", () => {
        if (currentMonth === 11) {
          currentMonth = 0;
          currentYear++;
        } else {
          currentMonth++;
        }
        renderCalendar(currentMonth, currentYear);
      });

      function renderCalendar(month, year) {
        calendar.innerHTML = ""; // Clear previous calendar

        monthYearDisplay.textContent = `${getMonthName(month)} ${year}`;

        const daysInMonth = new Date(year, month + 1, 0).getDate();

        for (let i = 1; i <= daysInMonth; i++) {
          const dayElement = document.createElement("div");
          dayElement.classList.add("day");
          dayElement.textContent = i;
          dayElement.dataset.date = new Date(year, month, i).toISOString(); // Set dataset with ISO date format

          dayElement.addEventListener("click", () => {
            openNoteModal(dayElement, month, year);
          });

          calendar.appendChild(dayElement);
        }
      }

      function openNoteModal(dayElement, month, year) {
        const selectedDay = parseInt(dayElement.textContent);
        const selectedDate = new Date(year, month, selectedDay);
        const formattedDate = selectedDate.toLocaleDateString("en-US", {
          month: "long",
          day: "numeric",
          year: "numeric",
        });
        noteModal.dataset.date = selectedDate.toISOString(); // Set dataset with ISO date format
        noteModal.style.display = "block";
        noteInput.value = getNoteForDate(selectedDate);
        saveNoteButton.onclick = () => {
          saveNoteForDate(selectedDate, noteInput.value);
          noteModal.style.display = "none";
          if (!noteInput.value.trim()) {
            dayElement.innerHTML = selectedDay;
          } else {
            dayElement.innerHTML = `${selectedDay}<span class='note-indicator'></span>`;
          }
        };
      }

      function getNoteForDate(date) {
        const savedNotes = JSON.parse(localStorage.getItem("notes")) || {};
        return savedNotes[date.toISOString()] || "";
      }

      function saveNoteForDate(date, note) {
        const savedNotes = JSON.parse(localStorage.getItem("notes")) || {};
        savedNotes[date.toISOString()] = note;
        localStorage.setItem("notes", JSON.stringify(savedNotes));
      }

      function loadSavedNotes() {
        const savedNotes = JSON.parse(localStorage.getItem("notes")) || {};
        const days = document.querySelectorAll(".day");
        days.forEach((dayElement) => {
          const dateKey = dayElement.dataset.date;
          if (dateKey && savedNotes[dateKey]) {
            dayElement.innerHTML = `${dayElement.textContent}<span class='note-indicator'></span>`;
          }
        });
      }

      function getMonthName(monthIndex) {
        const months = [
          "January",
          "February",
          "March",
          "April",
          "May",
          "June",
          "July",
          "August",
          "September",
          "October",
          "November",
          "December",
        ];
        return months[monthIndex];
      }
    </script>
  </body>
</html>
